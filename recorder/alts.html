<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Visualizer Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lamejs/1.2.0/lame.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #2c2c2c;
            color: #ffffff;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            width: 100%;
            text-align: center;
        }
        h1 {
            margin-bottom: 20px;
        }
        #recordButton {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: #f44336;
            border: none;
            cursor: pointer;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px auto;
        }
        #recordButton:disabled {
            background-color: #888;
            cursor: not-allowed;
        }
        #recordIcon {
            width: 20px;
            height: 20px;
            background-color: #ffffff;
            border-radius: 50%;
        }
        #visualizer {
            width: 100%;
            height: 200px;
            background-color: #3c3c3c;
            margin: 10px auto;
            display: none;
        }
        #visualizerSelect {
            margin: 10px auto;
            padding: 5px;
            font-size: 16px;
            background-color: #3c3c3c;
            color: #ffffff;
            border: none;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Audio Visualizer Test</h1>
        <select id="visualizerSelect">
            <option value="bar">Bar Visualizer</option>
            <option value="circular">Circular Visualizer</option>
            <option value="line">Line Graph Visualizer</option>
            <option value="particle">Particle Visualizer</option>
        </select>
        <button id="recordButton"><div id="recordIcon"></div></button>
        <canvas id="visualizer"></canvas>
    </div>

    <script>
        let mediaRecorder;
        let audioContext;
        let analyser;
        let microphone;
        const recordButton = document.getElementById('recordButton');
        const visualizer = document.getElementById('visualizer');
        const visualizerSelect = document.getElementById('visualizerSelect');
        let animationId;
        let currentVisualizer = 'bar';

        recordButton.onclick = async () => {
            if (!mediaRecorder || mediaRecorder.state === 'inactive') {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                microphone = audioContext.createMediaStreamSource(stream);
                microphone.connect(analyser);
                analyser.fftSize = 256;

                mediaRecorder = new MediaRecorder(stream);
                mediaRecorder.start();
                recordButton.style.backgroundColor = '#32CD32';
                visualizer.style.display = 'block';
                drawVisualization();
            } else {
                mediaRecorder.stop();
                recordButton.style.backgroundColor = '#f44336';
                cancelAnimationFrame(animationId);
                visualizer.style.display = 'none';
            }
        };

        visualizerSelect.addEventListener('change', (event) => {
            currentVisualizer = event.target.value;
        });

        function drawVisualization() {
            const canvas = document.getElementById('visualizer');
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            const bufferLength = analyser.frequencyBinCount;
            const dataArray = new Uint8Array(bufferLength);

            ctx.clearRect(0, 0, width, height);

            switch (currentVisualizer) {
                case 'bar':
                    drawBarVisualizer(ctx, width, height, bufferLength, dataArray);
                    break;
                case 'circular':
                    drawCircularVisualizer(ctx, width, height, bufferLength, dataArray);
                    break;
                case 'line':
                    drawLineGraphVisualizer(ctx, width, height, bufferLength, dataArray);
                    break;
                case 'particle':
                    drawParticleVisualizer(ctx, width, height, bufferLength, dataArray);
                    break;
            }

            animationId = requestAnimationFrame(drawVisualization);
        }

        function drawBarVisualizer(ctx, width, height, bufferLength, dataArray) {
            analyser.getByteFrequencyData(dataArray);

            ctx.fillStyle = '#3c3c3c';
            ctx.fillRect(0, 0, width, height);

            const barWidth = width / bufferLength * 2.5;
            let x = 0;

            for (let i = 0; i < bufferLength; i++) {
                const barHeight = dataArray[i] / 2;
                ctx.fillStyle = `rgb(${barHeight + 100}, 50, 50)`;
                ctx.fillRect(x, height - barHeight, barWidth, barHeight);
                x += barWidth + 1;
            }
        }

        function drawCircularVisualizer(ctx, width, height, bufferLength, dataArray) {
            analyser.getByteFrequencyData(dataArray);

            ctx.fillStyle = '#3c3c3c';
            ctx.fillRect(0, 0, width, height);

            ctx.translate(width / 2, height / 2);

            for (let i = 0; i < bufferLength; i++) {
                const radius = dataArray[i] * 0.5;
                const startAngle = (i * 2 * Math.PI) / bufferLength;
                const endAngle = ((i + 1) * 2 * Math.PI) / bufferLength;

                ctx.beginPath();
                ctx.arc(0, 0, radius, startAngle, endAngle);
                ctx.strokeStyle = `hsl(${i * 360 / bufferLength}, 100%, 50%)`;
                ctx.stroke();
            }

            ctx.setTransform(1, 0, 0, 1, 0, 0);
        }

        function drawLineGraphVisualizer(ctx, width, height, bufferLength, dataArray) {
            analyser.getByteTimeDomainData(dataArray);

            ctx.fillStyle = '#3c3c3c';
            ctx.fillRect(0, 0, width, height);

            ctx.lineWidth = 2;
            ctx.strokeStyle = '#4CAF50';
            ctx.beginPath();

            const sliceWidth = width / bufferLength;
            let x = 0;

            for (let i = 0; i < bufferLength; i++) {
                const v = dataArray[i] / 128.0;
                const y = v * height / 2;

                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }

                x += sliceWidth;
            }

            ctx.lineTo(width, height / 2);
            ctx.stroke();
        }

        const particles = [];

        class Particle {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.size = Math.random() * 5 + 1;
                this.speedY = Math.random() * 1 - 0.5;
                this.color = `hsl(${Math.random() * 360}, 100%, 50%)`;
            }

            update(baseY) {
                this.y = baseY + this.speedY * 50;
                if (this.size > 0.2) this.size -= 0.1;
            }

            draw(ctx) {
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function drawParticleVisualizer(ctx, width, height, bufferLength, dataArray) {
            analyser.getByteFrequencyData(dataArray);

            ctx.fillStyle = 'rgba(60, 60, 60, 0.2)';
            ctx.fillRect(0, 0, width, height);

            const barWidth = width / bufferLength;

            for (let i = 0; i < bufferLength; i++) {
                const barHeight = dataArray[i] / 2;
                const x = i * barWidth;
                const y = height - barHeight;

                if (Math.random() > 0.9) {
                    particles.push(new Particle(x, y));
                }

                for (let j = 0; j < particles.length; j++) {
                    particles[j].update(y);
                    particles[j].draw(ctx);

                    if (particles[j].size <= 0.2) {
                        particles.splice(j, 1);
                        j--;
                    }
                }
            }
        }
    </script>
</body>
</html>